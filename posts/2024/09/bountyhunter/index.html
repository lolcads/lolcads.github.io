<!doctype html><html lang=en dir=ltr><head><title>Adversary Emulation is a Complicated Profession - Intelligent Cyber Adversary Emulation with the Bounty Hunter :: lolcads tech blog</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Cyber Adversary Emulation Cyber adversary emulation is an assessment method where tactis, techniques, and procedures (TTPs) of real-world attackers are used to test the security controls of a system. It helps to understand how an attacker might penetrate defenses, to evaluate installed security mechanisms and to improve the security posture by addressing identified weaknesses. Furthermore, it allows running training scenarios for security professionals, e.g., in cyber ranges where practical exercises can be performed. Unfortunately, adversary emulation requires significant time, effort, and specialized professionals to conduct.
"><meta name=keywords content="Adversary Emulation,Caldera"><meta name=robots content="noodp"><link rel=manifest href=/manifest.json><meta property="og:url" content="https://lolcads.github.io/posts/2024/09/bountyhunter/"><meta property="og:site_name" content="lolcads tech blog"><meta property="og:title" content="Adversary Emulation is a Complicated Profession - Intelligent Cyber Adversary Emulation with the Bounty Hunter"><meta property="og:description" content="This blog post introduces the Bounty Hunter - a novel Caldera plugin for intelligent cyber adversary emulation. Its main contribution is the emulation of complete, realistic cyber attack chains. The Plugin is available on [**GitHub**](https://github.com/fkie-cad/bountyhunter)."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-12T10:00:00+02:00"><meta property="article:modified_time" content="2024-09-12T10:00:00+02:00"><meta property="article:tag" content="Adversary Emulation"><meta property="article:tag" content="Caldera"><meta property="article:tag" content="Cybersecurity"><meta name=twitter:card content="summary"><meta name=twitter:title content="Adversary Emulation is a Complicated Profession - Intelligent Cyber Adversary Emulation with the Bounty Hunter"><meta name=twitter:description content="This blog post introduces the Bounty Hunter - a novel Caldera plugin for intelligent cyber adversary emulation. Its main contribution is the emulation of complete, realistic cyber attack chains. The Plugin is available on [**GitHub**](https://github.com/fkie-cad/bountyhunter)."><link rel=canonical href=https://lolcads.github.io/posts/2024/09/bountyhunter/><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/index.min.c860e17f20d9f258820c02bf7ab3f57c9595d0bc21dede7eda08ccd63ba3f4cc.css></head><body class="flex flex-col min-h-screen w-full bg-slate-50 dark:bg-gray-800"><header class="flex flex-none justify-center z-10"><div class="flex flex-row gap justify-between w-full max-w-4xl lg:max-w-5xl h-12 mt-3"><div class="flex-none ml-2 md:ml-0"><a href=/><img class="h-12 w-12 rounded-full object-cover bg-gray-100" src=/logo.png alt=logo></a></div><div class=flex-1></div><div class=flex-none><nav class="h-full static"><button id=navbar-menu-toggle type=button class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg md:hidden" aria-controls=navbar-menu aria-expanded=false>
<span class=sr-only>Open main menu</span>
<i class="w-8 h-8"><svg class="icon icon-tabler icon-tabler-menu-2" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 6h16"/><path d="M4 12h16"/><path d="M4 18h16"/></svg></i></button><div class="absolute md:static top-16 left-0 right-0 z-50 hidden w-full md:block md:w-auto" id=navbar-menu><ul class="flex flex-col mx-2 md:mx-0 md:flex-row md:border-0 rounded-sm md:rounded-full px-3 text-base font-medium text-slate-800 dark:text-slate-200 shadow-lg bg-white dark:bg-gray-600 shadow-slate-800/5 dark:shadow-slate-200/5 ring-1 ring-slate-900/5 dark:ring-slate-100/5"><li id=post><a class="block px-3 py-3 hover:text-emerald-600 text-emerald-600" href=/posts/ title=Blog>Blog</a></li><li id=about><a class="block px-3 py-3 hover:text-emerald-600" href=/about/ title=About>About</a></li><li id=contact><a class="block px-3 py-3 hover:text-emerald-600" href=/contact/ title=Contact>Contact</a></li></ul></div></nav></div><div class="flex-none mx-1"></div><div class="flex-none md:hidden"><a href=/search/ class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg" aria-controls=navbar-menu aria-expanded=false><span class=sr-only>Search</span>
<i class="w-8 h-8"><svg class="icon icon-tabler icon-tabler-search" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1014 0A7 7 0 103 10"/><path d="M21 21l-6-6"/></svg></i></a></div><div class="darkmode-toggle flex flex-none mr-2 md:mr-0"><label for=darkmode-toggle class="flex items-center px-3 cursor-pointer rounded-full bg-gray-100 dark:bg-gray-600" title="Toggle dark mode"><input name=darkmode-toggle id=darkmode-toggle type=checkbox class="sr-only peer" aria-label="Toggle dark mode"><div class="group flex flex-row gap-1 justify-center h-8 px-1 rounded-full bg-white dark:bg-gray-700"><i class="h-6 w-6 flex-none rounded-full bg-yellow-400 place-self-center peer-checked:group-[]:invisible"><svg class="icon icon-tabler icon-tabler-brightness-down" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-3 0a3 3 0 106 0 3 3 0 10-6 0"/><path d="M12 5v.01"/><path d="M17 7v.01"/><path d="M19 12v.01"/><path d="M17 17v.01"/><path d="M12 19v.01"/><path d="M7 17v.01"/><path d="M5 12v.01"/><path d="M7 7v.01"/></svg>
</i><i class="h-6 w-6 flex-none rounded-full place-self-center invisible peer-checked:group-[]:visible"><svg class="icon icon-tabler icon-tabler-moon-stars" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/><path d="M17 4a2 2 0 002 2 2 2 0 00-2 2 2 2 0 00-2-2 2 2 0 002-2"/><path d="M19 11h2m-1-1v2"/></svg></i></div></label></div></div></header><main class="flex flex-auto justify-center"><div class="w-full max-w-4xl lg:max-w-5xl"><div class="flex flex-col mt-6 mx-2 md:mx-0 rounded-lg overflow-hidden shadow-md bg-white dark:bg-gray-700"><div><a href=/posts/2024/09/bountyhunter/><figure><img class="w-full object-cover h-36 md:h-48 xl:h-60" src=/2024/09/bountyhunter_logo_v1_title.png alt="Adversary Emulation is a Complicated Profession - Intelligent Cyber Adversary Emulation with the Bounty Hunter" title="Adversary Emulation is a Complicated Profession - Intelligent Cyber Adversary Emulation with the Bounty Hunter" loading=lazy></figure></a></div><div class="flex flex-col gap-y-3 p-6"><h1 class="text-4xl font-semibold text-slate-800 dark:text-slate-100"><a href=/posts/2024/09/bountyhunter/>Adversary Emulation is a Complicated Profession - Intelligent Cyber Adversary Emulation with the Bounty Hunter</a></h1><h2 class="my-4 text-large text-slate-600 dark:text-slate-300">This blog post introduces the Bounty Hunter - a novel Caldera plugin for intelligent cyber adversary emulation. Its main contribution is the emulation of complete, realistic cyber attack chains. The Plugin is available on <a href=https://github.com/fkie-cad/bountyhunter target=_blank rel=noopener><strong>GitHub</strong></a>
.</h2><ul class="flex flex-row flex-wrap text-slate-500 dark:text-slate-300"><li><a href=/tags/adversary-emulation/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>Adversary Emulation</span></a></li><li><a href=/tags/caldera/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>Caldera</span></a></li><li><a href=/tags/cybersecurity/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>Cybersecurity</span></a></li></ul><div class="flex flex-col gap-y-1 md:flex-row md:gap-y-0 md:gap-x-4 text-slate-500 dark:text-slate-300"><div class="flex flex-row text-base gap-x-1"><i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-calendar" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V7z"/><path d="M16 3v4"/><path d="M8 3v4"/><path d="M4 11h16"/><path d="M11 15h1"/><path d="M12 15v3"/></svg>
</i><time datetime=2024-09-12T10:00:00+02:00>2024-09-12</time></div><div class="flex flex-row text-base gap-x-1"><i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-hourglass-high" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6.5 7h11"/><path d="M6 20v-2a6 6 0 1112 0v2a1 1 0 01-1 1H7a1 1 0 01-1-1z"/><path d="M6 4v2a6 6 0 1012 0V4a1 1 0 00-1-1H7A1 1 0 006 4z"/></svg>
</i><span>6 minutes to read</span></div></div><div class="flex flex-col gap-y-1 md:flex-row md:gap-y-0 md:gap-x-4 text-slate-500 dark:text-slate-300"><div class="flex flex-row text-base gap-x-1"><i class="h-6 w-6 flex-none"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 7a4 4 0 108 0A4 4 0 008 7"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
</i><span>Louis Hackl√§nder-Jansen</span></div></div><section class="prose prose-slate dark:prose-invert w-full max-w-4xl lg:max-w-5xl mt-6"><h2>Table of Contents</h2><aside><nav id=TableOfContents><ul><li><a href=#cyber-adversary-emulation>Cyber Adversary Emulation</a></li><li><a href=#cyber-adversary-emulation-tools>Cyber Adversary Emulation Tools</a><ul><li><a href=#introducing-caldera-and-its-decision-engine>Introducing Caldera and its Decision Engine</a></li></ul></li><li><a href=#the-bounty-hunter>The Bounty Hunter</a><ul><li><a href=#scenario-1---initial-access-and-privilege-escalation>Scenario #1 - Initial Access and Privilege Escalation</a></li><li><a href=#scenario-2---emulating-an-apt29-campaign>Scenario #2 - Emulating an APT29 Campaign</a></li><li><a href=#configuration-of-the-bounty-hunter>Configuration of the Bounty Hunter</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></aside></section><article class="mt-6 w-full max-w-4xl lg:max-w-5xl prose prose-slate dark:prose-invert prose-quoteless post-content"><h2 id=cyber-adversary-emulation>Cyber Adversary Emulation</h2><p>Cyber adversary emulation is an assessment method where tactis, techniques, and procedures (TTPs) of real-world attackers are used to test the security controls of a system.
It helps to understand how an attacker might penetrate defenses, to evaluate installed security mechanisms and to improve the security posture by addressing identified weaknesses.
Furthermore, it allows running training scenarios for security professionals, e.g., in cyber ranges where practical exercises can be performed.
Unfortunately, adversary emulation requires significant time, effort, and specialized professionals to conduct.</p><p><div class=not-prose><figure><img src=/2024/09/bountyhunter_wernerherzog.png alt loading=lazy></figure></div></p><h2 id=cyber-adversary-emulation-tools>Cyber Adversary Emulation Tools</h2><p>In order to reduce the costs and increase the effectiveness of security assessments, adversary emulation tools can be used to automate the emulation of real-world attackers.
Also, such tools include built-in logging and reporting features that simplify documenting the assessment.
Thus, assessments become more accessible for less experienced personnel and more resource-efficient when using adversary emulation tools.
But the automation process also has drawbacks, e.g., they often depend on predefined playbooks resulting in limited scenario coverage, a lack of adaptability, and a high predictability.
As a consequence, simulated attacks fail more often and trainee personnel might recognize an attacker from previous scenarios, resulting in a lower quality in training experience.</p><h3 id=introducing-caldera-and-its-decision-engine>Introducing Caldera and its Decision Engine</h3><p><a href=https://github.com/mitre/caldera target=_blank rel=noopener>Caldera</a>
is an open-source, plugin-based cybersecurity platform developed by MITRE that can be used to emulate cyber adversaries.
It does not depend on playbooks as strongly as other adversary emulation tools do - instead it uses adversary profiles and planners.
While adversary profiles contain attacks steps to execute, the planners are unique decision logics that decide if, when, and how a step should be executed.
Even though Caldera comes with several planners out-of-the-box, it still has some limitations: (1) Repeating a scenario results in the same behavior since the planners make deterministic decisions, (2) only post-compromise methods are supported, and (3) simulated attack behavior can be unrealistic due to planner limitations.
To overcome these limitations, we developed and implemented a new plugin for Caldera - the Bounty Hunter.</p><h2 id=the-bounty-hunter>The Bounty Hunter</h2><p><a href=https://github.com/fkie-cad/bountyhunter target=_blank rel=noopener>The Bounty Hunter</a>
is a novel plugin for Caldera.
Its biggest asset is the Bounty Hunter Planner that allows the emulation of complete, realistic cyberattack chains.
Bounty Hunter&rsquo;s key features are:</p><ul><li><strong>Weighted-Random Attack Behavior.</strong> The Bounty Hunter&rsquo;s attack behavior is goal-oriented and reward-driven, similar to Caldera&rsquo;s Look-Ahead Planner. But instead of picking the ability with the highest future reward value every time, it offers the possibility to pick the next ability weighted-randomly. This adds an uncertainty to the planner&rsquo;s behavior which allows repeated runs of the same operation with different results. This is especially useful in training environments.</li><li><strong>Support for Initial Access and Privilege Escalation.</strong> At the moment, no Caldera planner offers support for initial access or privilege escalation methods. The Bounty Hunter extends Caldera&rsquo;s capabilities by offering support for both in a fully autonomous manner. This enables it to emulate complete cyberattack chains.</li><li><strong>Further Configurations for More Sophisticated and Realistic Attack Behavior.</strong> The Bounty Hunter offers various configuration parameters, e.g., &ldquo;locking&rdquo; abilities, reward updates, and final abilities, to customize the emulated attack behavior.</li></ul><p>The following two sections introduce two example scenarios to showcase the capabilities of the Bounty Hunter.
The first example describes how it emulates complete cyberattack chains, including initial access and privilege escalation.
In the second scenario, the Bounty Hunter is tasked to emulate a multistep attack based on an <a href=https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/apt29 target=_blank rel=noopener>APT29 campaign</a>
to demonstrate the level of complexity that it can achieve.</p><h3 id=scenario-1---initial-access-and-privilege-escalation>Scenario #1 - Initial Access and Privilege Escalation</h3><p>This example scenario demonstrates how the Bounty Hunter is able to perform initial access and privilege escalation autonomously.
The results of the demo operation using the Bounty Hunter and a demo adversary profile are shown in the picture below.
The operation is started with a Caldera agent (<code>yjjtqs</code>) running on the same machine as the Caldera server, i.e., a machine that is already controlled by the adversary.</p><p>As first step, the Bounty Hunter executes a Nmap host scan to find potential targets, followed by a Nmap port scan of found systems to gather information about them.
Depending on the gathered port as well as service and version information, an initial access agenda is chosen and executed.
In this scenario, the emulated adversary found an open SSH port and decides to try an SSH brute force attack.
It successfully gathers valid SSH credentials and uses them to copy and start a new Caldera agent on the target machine (<code>ycchap</code>).
Next, the Bounty Hunter detects that it needs elevated privileges for its chosen final ability (<code>Credential Dumping</code>) and decides to start a privilege escalation by running a UAC Bypass.
As a result of this step, a new elevated agent was started (<code>ebdwxy</code>) and the final ability can be executed, concluding the operation.</p><table><thead><tr><th style=text-align:center><div class=not-prose><figure><img src=/2024/09/bountyhunter_scenario1.png alt loading=lazy></figure></div></th></tr></thead><tbody><tr><td style=text-align:center><em>Example operation to demonstrate Initial Access and Privilege Escalation with the Bounty Hunter and a demo adversary profile. Note how three different agents are used during the different phases.</em></td></tr></tbody></table><h3 id=scenario-2---emulating-an-apt29-campaign>Scenario #2 - Emulating an APT29 Campaign</h3><p>The level of complexity the Bounty Hunter supports was tested using the APT29 Day2 data from the <a href=https://github.com/center-for-threat-informed-defense/adversary_emulation_library/ target=_blank rel=noopener>adversary emulation library</a>
of the Center for Threat Informed Defense.
The resulting attack chain including fact-links between steps is shown in the figure below.
The test showed that the Bounty Hunter is able to initially access a Windows Workstation using SSH brute force, elevate its privileges automatically using a Windows UAC Bypass, and finally compromise the whole domain using a Kerberos Golden Ticket Attack.</p><p>To achieve its goal, the Bounty Hunter was only provided with a high reward of the final ability that executes a command using the Golden Ticket and the name of the interface to scan initially.
All other information needed for the successful execution, including the domain name, domain admin credentials, SID values, and NTLM hashes, were collected autonomously.</p><table><thead><tr><th style=text-align:center><div class=not-prose><figure><img src=/2024/09/bountyhunter_scenario2.png alt loading=lazy></figure></div></th></tr></thead><tbody><tr><td style=text-align:center><em>Example operation to demonstrate the level of complexity the Bounty Hunter supports based on an APT29 campaign. During the campaign, a Windows Active Directory Domain is compromised by running a Kerberos Golden Ticket Attack.</em></td></tr></tbody></table><h3 id=configuration-of-the-bounty-hunter>Configuration of the Bounty Hunter</h3><p>The Bounty Hunter can be configured in various ways to further customize the emulated attack behavior.
Possible configurations range from custom ability rewards, over final and locked abilities to custom ability reward updates.
For detailed information on the configuration possibilities, please refer to the <a href="https://github.com/fkie-cad/bountyhunter?tab=readme-ov-file#advanced-information-and-configuration" target=_blank rel=noopener>description in the GitHub repository</a>
.</p><h2 id=conclusion>Conclusion</h2><p>Cyber adversary emulation is complicated and different approaches suffer from different drawbacks.
Common challenges of cyber adversary emulation tools (such as the well-known cybersecurity platform Caldera) are their predictability and limitations in their scope.
To overcome these challenges, we developed and implemented a new Caldera plugin - the Bounty Hunter.
The capabilities of the Bounty Hunter were demonstrated in two different scenarios, showing that it is capable of emulating initial access and privilege escalation methods as well as handling complex, multistep cyberattack chains, e.g., an attack based on an APT29 campaign.</p><p>The Bounty Hunter is <a href=https://github.com/fkie-cad/bountyhunter target=_blank rel=noopener>released open-source on GitHub</a>
with (deliberately unsophisticated) proof-of-concept attacks for Windows and Linux targets.</p></article></div></div></div></main><footer class="flex flex-none justify-center"><section class="flex flex-col md:flex-row mx-2 md:mx-0 gap-2 md:gap-0 justify-between w-full max-w-4xl lg:max-w-5xl py-6 text-slate-500 dark:text-slate-300"><div class="flex flex-row"></div><div class=grow></div><div class="flex flex-row"><i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-copyright" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1018 0A9 9 0 103 12"/><path d="M14 9.75a3.016 3.016.0 00-4.163.173 2.993 2.993.0 000 4.154A3.016 3.016.0 0014 14.25"/></svg>
</i>2022 - 2025 lolcads</div><div class="flex flex-row"><span class="ml-0 pl-0 md:ml-2 md:pl-2 border-l-0 md:border-l border-slate-300 dark:border-slate-400">Powered by <a href=https://gohugo.io target=_blank rel=noopener class=underline>Hugo</a> <span class=text-red-600>&#9829;</span> <a href=https://github.com/tomowang/hugo-theme-tailwind target=_blank rel=noopener class=underline>Tailwind</a></span></div></section></footer><script src=/main.min.c6372b6836971865bd94bfde974748aca8415824a2facab6ccd66a87384bfacb.js></script></body></html>